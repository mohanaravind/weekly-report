<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="bower_components/polymer/lib/elements/dom-if.html">

<link rel="import" href="wy-text-q.html">
<link rel="import" href="wy-rate-q.html">
<link rel="import" href="wy-button.html">


<dom-module id="wy-myreport">
  <template>
    <style>
      :host {
        display: block;
        padding: 10px;
      }
      
      .container {        
        display: flex;
      }
      
      .question {
        margin-bottom: 25px;
      }
      
      .spacer {
        height: 1px;
        width: 100%;        
        margin-bottom: 5px;
        background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0));
      }
            
      .check-icon {
        margin-right: 8px;
      }
            
      .footer {
        display: flex;
        justify-content: flex-end;
      }
      
      :host([readonly]) .footer {
        display: none;
      }
      
      .comments {
        display: none;
        color: white;
        background: rgba(255, 255, 255, 0.1);
        padding: 5px;
        border-radius: 3px;
        font-size: small;
      }
      
      :host([readonly]) .comment {        
        display: block;
      }
            
    </style> 
    
        
    <section>                  
      <template is="dom-repeat" items="{{data}}">

        <div class="spacer"></div>
        
        <template is="dom-if" if="{{item.isText}}">          
          <wy-text-q question="{{item.question}}" class="question" data-id$="{{item.qtype}}" value="{{item.answer}}" readonly="{{readonly}}"></wy-text-q>
        </template>
                
        <template is="dom-if" if="{{item.isRate}}">            
          <wy-rate-q question="{{item.question}}" class="question" value="{{item.answer}}" readonly="{{readonly}}"></wy-rate-q>
        </template>                
        
      </template>            
    </section>
    
    <div class="spacer"></div>
    
    <section class="comments">
      <template is="dom-repeat" items="{{comments}}">
        <wy-text-q question="{{item.owner}}" class="question" value="{{item.text}}"></wy-text-q>
      </template>
    </section>
    
    <footer class="footer">
      <wy-button class="btn" on-click="_submitReport"><span class="check-icon">&check;</span>SUBMIT</wy-button>
    </footer>
  </template>
  
  <script>    
    class MyReport extends Polymer.Element {
      static get is() { return "wy-myreport"; }                  
      
      static get properties() {
        return {
          readonly: {
            type: Boolean,            
            value: false,
            reflectToAttribute: true
          },
          data: {
            type: Array,
            value: [
              {
                isText: true,
                question: 'The challenges you are facing?',
                answer: null
              },
              {
                isText: true,
                question: 'The best thing that happened to you this week?',
                answer: null
              },
              {
                isRate: true,
                question: 'How are you feeling?',
                answer: null
              }
            ]
          },
          comments: Array
        };
      }
      
      _submitReport() {
        const detail = { data: this.data };
        
        this.dispatchEvent(new CustomEvent('submit-report', { detail }));
      }
      
      initReport(report) {
        this.data = report.data;
      }
      
    }
    
    
    
    window.addEventListener('WebComponentsReady', function() {      
      customElements.define('wy-myreport', MyReport);
    });
  </script>
</dom-module>