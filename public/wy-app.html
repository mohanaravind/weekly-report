<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/polymer/lib/utils/import-href.html">

<link rel="import" href="wy-sidepanel.html">
<link rel="import" href="wy-myreport.html">

<link rel="import" href="wy-teamreport.html">
<link rel="import" href="wy-settings.html">

<dom-module id="wy-app">
  <template>
    <style>
      :host {
        display: block;
      }
      
      .main {
        height: 100%;
        width: 100%;
      }
            
      .header {
        height: 50px;
        text-align: center;	
        color: white;
        padding-bottom: 15px;
      }
      
      .title {
        margin: 0;
        font-weight: lighter;
      }
      
      .is-side-panel-expanded .title, .is-side-panel-expanded .main {
        filter: blur(2px);
      }
      
    </style> 
        
    <div id="container">
      <wy-sidepanel id="sidepanel" selected-value="{{title}}" on-toggle="_blur" on-switch="_switch"></wy-sidepanel>
      <header class="header" on-click="_hideSidepanel">              
        <h1 class="title">[[title]]</h1>
      </header>
      <main id="main" class="main" on-click="_hideSidepanel">
        <div>
          Loading...
        </div>
      </main>
    </div>
  </template>
  
  <script>    
    class App extends Polymer.Element {
      static get is() { return "wy-app"; }
      
      connectedCallback() {
        super.connectedCallback();
        
        window.location.hash = window.location.hash || '#myreport';
        
        // Initial load
        this.$.sidepanel.switchTo(window.location.hash);        
      }
      
      _blur() {        
        this.$.container.classList.toggle('is-side-panel-expanded');
      }
      
      _hideSidepanel() {
        this.$.sidepanel.hide();
      }
      
      _switch(event) {
        const context = event.detail.context;        
        let tag = null;
        
        switch (context) {
          case 'My Report':
            tag = 'wy-myreport';            
            break;
          case 'Team Report':
            tag = 'wy-teamreport';
            break;
            
          case 'Settings':
            tag = 'wy-settings';
            break;
        }
                            
        Polymer.importHref('/' + tag + '.html', () => {
          const main = this.$.main;
          
          // Create the new view element
          const elem = document.createElement(tag);                    
          
          // Remove the existing children
          main.removeChild(main.children[0]);
          
          // Add it to the DOM
          main.appendChild(elem);
        });                
      }
    }
    
    window.addEventListener('WebComponentsReady', function() {      
      customElements.define('wy-app', App);
    });
  </script>
</dom-module>